<div class="card">
  <div class="card-header">
    <i class="fa fa-edit"></i>{{ id ? "Edit" : "Add" }} Professional Tax
  </div>
  <div
    class="card-body"
    style="overflow: visible; height: auto; display: block;"
    aria-expanded="true"
    aria-hidden="false"
  >
    <form
      [formGroup]="professionalTaxFormGroup"
      class="form-horizontal"
      (ngSubmit)="onSubmit()"
    >
      <div class="row m-b-10">
        <div class="col-md-4">
          <mat-form-field style="width:100%">
            <mat-label>County</mat-label>
            <select
              matNativeControl
              formControlName="country_id"
              (change)="getStateDependency(f.country_id.value)"
            >
              <option value="">--Select country--</option>
              <option
                *ngFor="let item of dropdown.country"
                value="{{ item.id }}"
                >{{ item.name }}</option
              >
            </select>
            <mat-error *ngIf="f.country_id.errors">
              <span *ngIf="f.country_id.errors.required">
                Country name is required</span
              >
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-4">
          <mat-form-field style="width:100%">
            <mat-label>State</mat-label>
            <select matNativeControl formControlName="state_id">
              <option value="">--Select state--</option>
              <option
                *ngFor="let item of dropdown.state"
                value="{{ item.id }}"
                >{{ item.name }}</option
              >
            </select>
            <mat-error *ngIf="f.state_id.errors">
              <span *ngIf="f.state_id.errors.required">
                State name is required</span
              >
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row m-b-10">
        <div class="col-md-12">
          <button
            class="pull-right"
            mat-mini-fab
            color="primary"
            (click)="addTaxdetailsValue()"
          >
            <i class="fa fa-plus"></i>
          </button>
        </div>
      </div>
      <div class="row m-b-10">
        <div class="col-md-12">
          <ng-template [ngIf]="taxdetails">
            <mat-accordion formArrayName="taxdetails">
              <mat-expansion-panel
                *ngFor="let addr of taxdetails.controls; let i = index"
                [formGroupName]="i"
                expanded="false"
                class="m-b-10 expansion-header-custom"
              >
                <mat-expansion-panel-header>
                  <mat-panel-title>Tax Set {{ i + 1 }}
                  </mat-panel-title>
                  <mat-panel-description>
                    <div class="col-md-12 p-r-0">
                      <button type="button"
                              style="background: transparent;"
                              class="btn  btn-icon btn-default task-add-btn float-right">
                          <i (click)="$event.stopPropagation();deleteTaxdetailsValue(i)"
                             class="fa fa-trash"></i>
                      </button>
                  </div>
                </mat-panel-description>
                </mat-expansion-panel-header>
                <div class="row m-t-20">
                  <div class="col-md-4">
                    <mat-form-field style="width:100%">
                      <mat-label> Salary </mat-label>
                      <!-- (change)="changeSalaryRange()" -->
                      <select matNativeControl formControlName="salary_range">
                        <option value="">--Select range--</option>
                        <option value="1"> Upto </option>
                        <option value="2"> Between </option>
                        <option value="3"> Above </option>
                      </select>
                      <mat-error
                        *ngIf="addr.invalid && addr.get('salary_range').errors"
                      >
                        <span *ngIf="addr.get('salary_range').errors?.required"
                          >Salary Range is required</span
                        >
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field style="width:100%">
                      <input matInput formControlName="salary_from" />
                      <mat-error
                        *ngIf="addr.invalid && addr.get('salary_from').errors"
                      >
                        <span *ngIf="addr.get('salary_from').errors?.required">
                          Salary is required</span
                        >
                        <span *ngIf="addr.get('salary_from').errors?.pattern">
                            Salary is invalid</span
                          >
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <div
                    class="col-md-4"
                    *ngIf="addr.get('salary_range')?.value == 2"
                  >
                    <mat-form-field style="width:100%">
                      <input matInput formControlName="salary_to" />
                      <mat-error
                        *ngIf="addr.invalid && addr.get('salary_to').errors"
                      >
                        <span *ngIf="addr.get('salary_to').errors?.required">
                          Salary to is required</span>
                        <span *ngIf="addr.get('salary_to').errors?.pattern">
                          Salary to is invalid</span>
                      </mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field style="width:100%">
                      <mat-label> Slab </mat-label>
                      <select matNativeControl formControlName="slab">
                        <option value="">--Select slab--</option>
                        <option value="1"> Monthly </option>
                        <option value="2"> Yearly </option>
                      </select>
                      <mat-error
                        *ngIf="addr.invalid && addr.get('slab').errors"
                      >
                        <span *ngIf="addr.get('slab').errors?.required"
                          >Slab is required</span
                        >
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field style="width:100%">
                      <mat-label> PT Amount </mat-label>
                      <input matInput formControlName="pt_amount" />
                      <mat-error
                        *ngIf="addr.invalid && addr.get('pt_amount').errors"
                      >
                        <span *ngIf="addr.get('pt_amount').errors?.required">
                          Amount is required</span
                        >
                        <span *ngIf="addr.get('pt_amount').errors?.pattern">
                          Amount is invalid</span
                        >
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-slide-toggle
                      formControlName="exemption"
                      color="primary"
                      style="padding-top: 14px;"
                    >
                      {{
                        addr.get("exemption")?.value
                          ? "Applicable"
                          : "Not Applicable"
                      }}
                    </mat-slide-toggle>
                  </div>
                </div>
                <div class="row" *ngIf="addr.get('exemption')?.value">
                  <div class="col-md-4">
                    <mat-form-field style="width:100%">
                      <mat-label> Age </mat-label>
                      <input matInput formControlName="exemption_age" />
                      <mat-error
                        *ngIf="addr.invalid && addr.get('exemption_age').errors"
                      >
                        <span
                          *ngIf="addr.get('exemption_age').errors?.required"
                        >
                          Age is required</span
                        >
                        <span *ngIf="addr.get('exemption_age').errors?.pattern">
                          Age is invalid</span
                        >
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field style="width:100%">
                      <mat-label> Details </mat-label>
                      <input matInput formControlName="exemption_details" />
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12">
                    <mat-form-field style="width:100%">
                      <mat-label>Remarks</mat-label>
                      <textarea
                        matInput
                        placeholder="Remarks"
                        formControlName="remarks"
                      ></textarea>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field style="width:100%">
                      <mat-label>PT Reminder Days </mat-label>
                      <select matNativeControl formControlName="reminder_days">
                        <option value="">--Select Days--</option>
                        <option value="1"> 1 Day </option>
                        <option value="10"> 10 Days </option>
                        <option value="20"> 20 Days </option>
                        <option value="40"> 40 Days </option>
                      </select>
                      <mat-error
                        *ngIf="addr.invalid && addr.get('reminder_days').errors"
                      >
                        <span *ngIf="addr.get('reminder_days').errors?.required"
                          >Slab is required</span
                        >
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field style="width:100%">
                      <mat-label> Returns </mat-label>
                      <select matNativeControl formControlName="returns">
                        <option value="">--Select Returns--</option>
                        <option value="1"> Quarterly </option>
                        <option value="2"> Half Yearly </option>
                        <option value="3"> Yearly </option>
                      </select>
                      <mat-error
                        *ngIf="addr.invalid && addr.get('returns').errors"
                      >
                        <span *ngIf="addr.get('returns').errors?.required"
                          >Returns is required</span
                        >
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <!-- <div class="col-md-4">
                    <input
                      #csvInput
                      hidden="true"
                      type="file"
                      onclick="this.value=null"
                      (change)="csvInputChange($event)"
                      accept=".csv"
                    />
                    <button
                      mat-mini-fab
                      color="primary"
                      (click)="csvInput.click()"
                    >
                      <i class="fa fa-upload"></i>
                    </button>
                  </div> -->
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </ng-template>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="pull-right">
            <button mat-button (click)="resetForm()">Cancel</button>
            <button mat-flat-button type="submit" color="primary">
              Submit
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
